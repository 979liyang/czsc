# Feature Specification: CZSC API与前端界面增强

**Feature Branch**: `001-czsc-api-ui`  
**Created**: 2025-01-27  
**Status**: Draft  
**Input**: User description: "优化当前项目使用起来更方便。不改动czsc里面的内容，只使用czsc文件夹里面的内容。先学习理解当前项目后，提供更多的案例，之后提供API层和对应的前端页面，学习理解czsc里面的所有信号signals，并提供完美的股票历史数据存储的方案，要求和所需信号函数对应上。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 通过Web界面进行缠论分析 (Priority: P1)

用户希望通过浏览器访问Web界面，输入股票代码和时间范围，查看缠论分析结果（分型、笔、中枢），无需编写代码即可使用CZSC的核心功能。

**Why this priority**: 这是最基础的用户需求，降低了使用门槛，让非技术用户也能使用CZSC进行技术分析。

**Independent Test**: 用户可以在浏览器中访问Web界面，输入股票代码"000001.SH"，选择日线周期，查看2023年的分析结果，系统应显示K线图、分型标记、笔的识别结果。

**Acceptance Scenarios**:

1. **Given** 用户打开Web界面首页, **When** 输入股票代码和时间范围, **Then** 系统显示该股票的缠论分析结果（分型、笔、中枢）
2. **Given** 分析结果已显示, **When** 用户点击"查看详情", **Then** 系统显示详细的笔列表、分型列表和中枢信息
3. **Given** 用户查看分析结果, **When** 用户切换不同的时间周期（日线、周线、月线）, **Then** 系统重新计算并显示对应周期的分析结果

---

### User Story 2 - 通过API获取股票数据和信号 (Priority: P1)

开发者希望通过REST API获取股票K线数据、计算信号、执行策略回测，以便集成到自己的应用系统中。

**Why this priority**: API层是系统集成的基础，使CZSC能够被其他系统调用，扩展了使用场景。

**Independent Test**: 开发者可以通过HTTP请求调用 `/api/v1/bars?symbol=000001.SH&freq=D&sdt=20230101&edt=20231231` 获取K线数据，调用 `/api/v1/signals?symbol=000001.SH&freq=D&signal=cxt_bi_status_V230101` 获取信号计算结果。

**Acceptance Scenarios**:

1. **Given** API服务已启动, **When** 发送GET请求获取K线数据, **Then** 系统返回JSON格式的K线数据列表
2. **Given** 提供了股票代码和信号函数名, **When** 发送GET请求计算信号, **Then** 系统返回该信号的计算结果
3. **Given** 提供了策略配置, **When** 发送POST请求执行回测, **Then** 系统返回回测结果（收益、回撤、交易记录等）

---

### User Story 3 - 查看和学习信号函数文档 (Priority: P2)

用户希望了解CZSC中所有可用的信号函数，包括函数说明、参数、返回值和使用示例，以便选择合适的信号函数构建策略。

**Why this priority**: 信号函数是策略构建的基础，用户需要理解每个信号的含义和用法才能有效使用。

**Independent Test**: 用户访问信号函数文档页面，可以看到所有信号函数的分类列表（缠论类、技术指标类、成交量类等），点击某个信号函数可以查看详细说明、参数说明和使用示例。

**Acceptance Scenarios**:

1. **Given** 用户访问信号函数文档页面, **When** 浏览信号函数列表, **Then** 系统显示所有信号函数，按类别分组（cxt、tas、bar、vol等）
2. **Given** 用户查看某个信号函数详情, **When** 阅读函数说明, **Then** 系统显示函数功能描述、参数说明、返回值格式和使用示例代码
3. **Given** 用户想测试信号函数, **When** 在文档页面输入股票代码和参数, **Then** 系统实时计算并显示信号结果

---

### User Story 4 - 使用更多策略示例 (Priority: P2)

用户希望看到更多实际可用的策略示例代码，包括不同市场、不同周期的策略，以便学习和参考。

**Why this priority**: 示例代码是学习的最佳方式，更多示例可以帮助用户快速上手和扩展应用。

**Independent Test**: 用户在示例代码目录中可以看到多个策略示例文件，每个示例包含完整的代码、说明文档和运行结果，用户可以直接运行或修改这些示例。

**Acceptance Scenarios**:

1. **Given** 用户查看示例代码目录, **When** 浏览示例列表, **Then** 系统显示多个策略示例，每个示例包含名称、描述、适用市场等信息
2. **Given** 用户选择某个示例, **When** 查看示例代码, **Then** 系统显示完整的代码、说明文档和使用方法
3. **Given** 用户运行示例代码, **When** 执行策略回测, **Then** 系统生成回测结果和可视化图表

---

### User Story 5 - 高效的数据存储和检索 (Priority: P2)

系统需要能够高效存储和检索大量股票的历史K线数据，支持按股票代码、时间范围、周期快速查询，并确保数据完整性和一致性。

**Why this priority**: 数据存储是系统性能的基础，良好的存储方案可以大幅提升数据访问速度和分析效率。

**Independent Test**: 系统可以存储1000只股票10年的日线数据，查询任意股票在任意时间范围的K线数据响应时间小于1秒，数据更新时不会影响查询性能。

**Acceptance Scenarios**:

1. **Given** 系统已存储股票历史数据, **When** 查询某只股票在指定时间范围的K线, **Then** 系统在1秒内返回完整数据
2. **Given** 需要更新某只股票的最新数据, **When** 执行数据更新操作, **Then** 系统增量更新数据，不影响已有数据的完整性
3. **Given** 需要批量查询多只股票数据, **When** 发送批量查询请求, **Then** 系统并行处理并返回所有结果

---

### Edge Cases

- 当股票代码不存在时，系统应返回明确的错误信息
- 当时间范围超出数据范围时，系统应返回可用数据并提示范围限制
- 当信号函数计算失败时，系统应记录错误日志并返回友好的错误信息
- 当数据存储空间不足时，系统应提供清理旧数据的机制
- 当API请求频率过高时，系统应实施限流保护
- 当前端页面长时间无操作时，系统应保持会话有效性

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供Web界面，允许用户通过浏览器进行缠论分析，无需编写代码
- **FR-002**: 系统必须提供REST API接口，支持获取K线数据、计算信号、执行策略回测
- **FR-003**: 系统必须提供信号函数文档，包含所有信号函数的说明、参数、返回值和使用示例
- **FR-004**: 系统必须提供至少10个不同场景的策略示例代码，每个示例包含完整代码和说明文档
- **FR-005**: 系统必须实现高效的股票历史数据存储方案，支持快速查询和增量更新
- **FR-006**: 系统必须支持所有CZSC信号函数的数据需求，确保存储方案与信号函数完全兼容
- **FR-007**: 系统必须提供数据可视化功能，包括K线图、分型标记、笔的绘制、信号展示
- **FR-008**: 系统必须支持多周期分析，用户可以在同一界面查看不同周期的分析结果
- **FR-009**: 系统必须提供策略回测功能，包括收益计算、回撤分析、交易记录导出
- **FR-010**: 系统必须提供API认证机制，保护API接口不被滥用
- **FR-011**: 系统必须记录所有API请求和错误日志，便于问题排查
- **FR-012**: 系统必须支持数据缓存机制，提升重复查询的响应速度
- **FR-013**: 系统必须提供数据质量检查功能，确保存储的K线数据完整且正确
- **FR-014**: 系统必须支持批量数据导入和导出功能
- **FR-015**: 前端界面必须响应式设计，支持桌面和移动设备访问

### Key Entities *(include if feature involves data)*

- **股票K线数据 (StockKlineData)**: 包含股票代码、时间、开高低收、成交量等基本信息，支持多种时间周期，是缠论分析的基础数据
- **信号计算结果 (SignalResult)**: 包含信号名称、信号值、计算时间、相关参数等信息，是策略构建的基础
- **策略配置 (StrategyConfig)**: 包含策略名称、持仓配置、信号配置、参数设置等信息，用于策略回测和执行
- **回测结果 (BacktestResult)**: 包含收益曲线、回撤信息、交易记录、绩效指标等，用于策略评估
- **用户会话 (UserSession)**: 包含用户标识、访问权限、会话状态等信息，用于Web界面状态管理

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在5分钟内通过Web界面完成一次完整的缠论分析（从输入股票代码到查看结果）
- **SC-002**: API接口响应时间：K线数据查询在1秒内返回，信号计算在3秒内完成，策略回测在30秒内完成（单只股票1年数据）
- **SC-003**: 系统支持存储至少5000只股票10年的历史数据，总数据量不超过500GB
- **SC-004**: 信号函数文档覆盖率达到100%，每个信号函数都有详细说明和使用示例
- **SC-005**: 提供至少15个不同场景的策略示例代码，覆盖股票、期货、ETF等不同市场
- **SC-006**: 数据存储方案支持所有CZSC信号函数的数据需求，信号计算成功率不低于99%
- **SC-007**: Web界面支持至少100个并发用户同时访问，系统响应不出现明显延迟
- **SC-008**: API接口支持每秒至少50个请求，在正常负载下错误率低于1%
- **SC-009**: 90%的用户可以在首次使用时成功完成一次完整的分析流程，无需查看帮助文档
- **SC-010**: 数据查询缓存命中率达到70%以上，显著提升重复查询的响应速度

## Assumptions

- 用户具备基本的股票知识，了解缠论的基本概念（分型、笔、中枢）
- 系统运行在标准的服务器环境中，具备足够的计算和存储资源
- 数据源可以通过czsc.connectors模块获取，无需额外配置
- 用户主要使用中文界面，所有文本和文档使用中文
- Web界面主要面向桌面浏览器，移动端提供基础功能支持
- API接口主要面向技术用户，提供标准的RESTful接口
- 数据存储使用关系型数据库或时序数据库，支持SQL查询
- 系统不需要用户认证即可使用基础功能，高级功能可能需要认证

## Dependencies

- CZSC核心库（czsc文件夹）必须可用，所有功能基于czsc库实现
- Python 3.8+ 运行环境
- Web框架（如Flask或FastAPI）用于API服务
- 前端框架（如React或Vue）用于Web界面
- 数据库系统（如PostgreSQL、MySQL或ClickHouse）用于数据存储
- 数据可视化库（如ECharts、Plotly）用于图表展示

## Out of Scope

- 不修改czsc核心库的任何代码，只使用czsc提供的接口
- 不实现实时交易功能，只提供分析和回测功能
- 不提供策略自动优化功能，用户需要手动调整参数
- 不提供多用户权限管理，所有用户共享相同的数据和功能
- 不实现数据源的直接接入，依赖czsc.connectors模块获取数据
- 不提供移动端原生应用，只提供Web界面

## Notes

- 所有功能必须基于czsc库实现，不能修改czsc核心代码
- 信号函数文档需要详细分析czsc/signals目录下的所有信号函数
- 数据存储方案需要考虑不同信号函数的数据需求，确保兼容性
- API接口设计要遵循RESTful规范，便于集成和使用
- Web界面要注重用户体验，提供直观的可视化展示
